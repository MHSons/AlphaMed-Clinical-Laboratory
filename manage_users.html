```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Manage Users - Alpha-Med Clinical Lab</title>
  <link rel="stylesheet" href="style.css" />
  <script defer src="storage.js"></script>
</head>
<body>
  <header>
    <h1>Manage Users - Alpha-Med Clinical Lab</h1>
  </header>

  <div class="container">
    <h2>Add/Edit User</h2>
    <form id="userForm">
      <input type="text" id="cnic" placeholder="CNIC (e.g. 34501-1234567-1)" required />
      <input type="text" id="name" placeholder="Full Name" required />
      <select id="role" required>
        <option value="">Select Role</option>
        <option value="Receptionist">Receptionist</option>
        <option value="Technician">Technician</option>
        <option value="Admin">Admin</option>
      </select>
      <input type="password" id="password" placeholder="Password" required />
      <input type="hidden" id="editIndex" />
      <button type="submit" id="submitButton">Add User</button>
    </form>
    <div class="error" id="error"></div>

    <h3>Search Users</h3>
    <input type="text" id="searchUser" placeholder="Search by CNIC or Name..." />

    <table id="userTable">
      <thead>
        <tr>
          <th>CNIC</th>
          <th>Name</th>
          <th>Role</th>
          <th>Password</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="userList"></tbody>
    </table>
  </div>

  <footer>&copy; 2025 Alpha-Med Clinical Lab</footer>

  <script>
    function loadUsers() {
      const users = window.getAllUsers();
      const tbody = document.getElementById("userList");
      const errorDiv = document.getElementById("error");
      tbody.innerHTML = "";

      if (!users.length) {
        errorDiv.textContent = "No users found";
        return;
      }

      errorDiv.textContent = "";
      users.forEach((user, index) => {
        const row = tbody.insertRow();
        row.innerHTML = `
          <td>${user.cnic}</td>
          <td>${user.name}</td>
          <td>${user.role}</td>
          <td>${"*".repeat(user.password.length)}</td>
          <td>
            <button class="btn-primary" onclick="editUser(${index})">Edit</button>
            <button class="btn-danger" onclick="window.deleteUser(${index}); loadUsers();">Delete</button>
          </td>
        `;
      });

      window.attachTableSearch("searchUser", "userTable");
    }

    function editUser(index) {
      const users = window.getAllUsers();
      const user = users[index];
      document.getElementById("cnic").value = user.cnic;
      document.getElementById("name").value = user.name;
      document.getElementById("role").value = user.role;
      document.getElementById("password").value = atob(user.password);
      document.getElementById("editIndex").value = index;
      document.getElementById("submitButton").textContent = "Update User";
    }

    document.getElementById("userForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const cnic = document.getElementById("cnic").value.trim();
      const name = document.getElementById("name").value.trim();
      const role = document.getElementById("role").value;
      const password = document.getElementById("password").value;
      const editIndex = document.getElementById("editIndex").value;
      const errorDiv = document.getElementById("error");

      const user = { cnic, name, role, password: btoa(password) };
      const saved = editIndex ? window.updateUser(parseInt(editIndex), user) : window.addUser(user);

      if (!saved) {
        errorDiv.textContent = editIndex ? "Error updating user" : "User with this CNIC already exists";
        return;
      }

      errorDiv.textContent = "";
      document.getElementById("userForm").reset();
      document.getElementById("submitButton").textContent = "Add User";
      document.getElementById("editIndex").value = "";
      loadUsers();
    });

    document.addEventListener("DOMContentLoaded", loadUsers);
  </script>
</body>
</html>
```
